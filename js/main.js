// Translations embedded to support file:// protocol without local server
const translations = {
    "en": {
        "nav_home": "Home",
        "nav_about": "About",
        "nav_skills": "Skills",
        "nav_experience": "Experience",
        "nav_projects": "Projects",
        "nav_news": "AI News",
        "nav_contact": "Contact",
        "hero_greeting": "Hello, I'm",
        "hero_title": "Issam Mezdagat",
        "hero_subtitle": "Full-Stack Developer <span class=\"accent\">&</span> AI Specialist",
        "hero_desc": "Building the future with Code and Artificial Intelligence. Based in Madrid, Spain.",
        "btn_view_work": "View Work",
        "btn_contact": "Contact Me",
        "scroll_text": "Scroll",
        "about_title": "About Me",
        "about_p1": "I am a <strong>Full-Stack Software Developer</strong> with a strong specialization in <strong>Artificial Intelligence</strong>, currently pursuing a Master's degree in AI Engineering.",
        "about_p2": "My passion lies at the intersection of software development and AI application. I thrive in collaborative environments and love tackling technical challenges. I am constantly learning and innovating, with a special interest in web development, mobile development, and AI-based solutions.",
        "location": "Madrid, Spain",
        "languages": "English (Preparing for C1), Spanish",
        "profile_role": "AI Engineer in Training",
        "skills_title": "Technical Arsenal",
        "skills_prog": "Programming & Databases",
        "skills_ai": "Artificial Intelligence",
        "skills_dev": "Development",
        "skills_devops": "DevOps & Infrastructure",
        "exp_title": "Experience",
        "exp_1_role": "AI Project Developer",
        "exp_1_company": "Universidad Politécnica de Madrid (UPM)",
        "exp_1_desc": "<ul><li>Participated in the development of a language model from scratch.</li><li>Used OLLAMA as a base to train and build a custom LLM.</li><li>Worked in a fully isolated environment managed with Docker.</li><li>Published model versions on Docker Hub.</li><li>Created charts and data visualizations through a website built with HTML + Angular.</li></ul>",
        "exp_2_role": "Incident Management",
        "exp_2_company": "Inetnum",
        "exp_2_desc": "<ul><li>Managed incidents related to the interface used in Repsol gas stations.</li><li>Used an internal ERP for tracking and resolving incidents.</li><li>Verified and diagnosed network connections.</li><li>Provided technical support through remote access using VMware.</li></ul>",
        "edu_title": "Education",
        "edu_1_title": "Master’s in Artificial Intelligence",
        "edu_1_subtitle": "AI Engineering",
        "edu_1_desc": "Advanced training in ML, Deep Learning, NLP, and AI deployment.",
        "edu_2_title": "Multiplatform Application Development (DAM)",
        "edu_2_desc": "Focus on web and mobile development (Angular, Android Studio).",
        "edu_3_title": "Network Computer Systems Administration (ASIR)",
        "edu_3_desc": "System administration, security, networks, and virtualization.",
        "projects_title": "Featured Projects",
        "proj_1_title": "Informed Consent Assistant",
        "proj_1_subtitle": "UPM Association",
        "proj_1_desc": "An application to simplify informed consent in the medical field using an LLM based on LLaMA 3. Simplifies technical language and presents it in English, Spanish, and French.",
        "proj_2_title": "TrAIner",
        "proj_2_subtitle": "AI-Powered Fitness App",
        "proj_2_desc": "Mobile application for managing workouts and nutrition. Includes TrAInerBot, a virtual assistant based on AI.",
        "news_title": "Latest AI News",
        "contact_title": "Get In Touch",
        "footer_text": "&copy; 2025 Issam Mezdagat. Built with Code & AI."
    },
    "es": {
        "nav_home": "Inicio",
        "nav_about": "Sobre Mí",
        "nav_skills": "Habilidades",
        "nav_experience": "Experiencia",
        "nav_projects": "Proyectos",
        "nav_news": "Noticias IA",
        "nav_contact": "Contacto",
        "hero_greeting": "Hola, soy",
        "hero_title": "Issam Mezdagat",
        "hero_subtitle": "Desarrollador Full-Stack <span class=\"accent\">y</span> Especialista en IA",
        "hero_desc": "Construyendo el futuro con Código e Inteligencia Artificial. Con base en Madrid, España.",
        "btn_view_work": "Ver Proyectos",
        "btn_contact": "Contáctame",
        "scroll_text": "Desliza",
        "about_title": "Sobre Mí",
        "about_p1": "Soy un <strong>Desarrollador de Software Full-Stack</strong> con una fuerte especialización en <strong>Inteligencia Artificial</strong>, actualmente cursando un Máster en Ingeniería de IA.",
        "about_p2": "Mi pasión se encuentra en la intersección del desarrollo de software y la aplicación de la IA. Me desenvuelvo bien en entornos colaborativos y me encanta afrontar retos técnicos. Estoy constantemente aprendiendo e innovando, con especial interés en el desarrollo web, móvil y soluciones basadas en IA.",
        "location": "Madrid, España",
        "languages": "Inglés (Preparando C1), Español",
        "profile_role": "Ingeniero de IA en Formación",
        "skills_title": "Arsenal Técnico",
        "skills_prog": "Programación y Bases de Datos",
        "skills_ai": "Inteligencia Artificial",
        "skills_dev": "Desarrollo",
        "skills_devops": "DevOps e Infraestructura",
        "exp_title": "Experiencia",
        "exp_1_role": "Desarrollador de Proyectos de IA",
        "exp_1_company": "Universidad Politécnica de Madrid (UPM)",
        "exp_1_desc": "<ul><li>Participé en el desarrollo de un modelo de lenguaje desde cero.</li><li>Utilicé OLLAMA como base para entrenar y construir un LLM personalizado.</li><li>Trabajé en un entorno totalmente aislado gestionado con Docker.</li><li>Publiqué versiones del modelo en Docker Hub.</li><li>Creé gráficos y visualizaciones de datos a través de un sitio web construido con HTML + Angular.</li></ul>",
        "exp_2_role": "Gestión de Incidencias",
        "exp_2_company": "Inetnum",
        "exp_2_desc": "<ul><li>Gestioné incidencias relacionadas con la interfaz utilizada en las gasolineras de Repsol.</li><li>Utilicé un ERP interno para el seguimiento y resolución de incidencias.</li><li>Verifiqué y diagnostiqué conexiones de red.</li><li>Proporcioné soporte técnico mediante acceso remoto usando VMware.</li></ul>",
        "edu_title": "Educación",
        "edu_1_title": "Máster en Inteligencia Artificial",
        "edu_1_subtitle": "Ingeniería de IA",
        "edu_1_desc": "Formación avanzada en ML, Deep Learning, NLP y despliegue de IA.",
        "edu_2_title": "Desarrollo de Aplicaciones Multiplataforma (DAM)",
        "edu_2_desc": "Enfoque en desarrollo web y móvil (Angular, Android Studio).",
        "edu_3_title": "Administración de Sistemas Informáticos en Red (ASIR)",
        "edu_3_desc": "Administración de sistemas, seguridad, redes y virtualización.",
        "projects_title": "Proyectos Destacados",
        "proj_1_title": "Asistente de Consentimiento Informado",
        "proj_1_subtitle": "Asociación UPM",
        "proj_1_desc": "Una aplicación para simplificar el consentimiento informado en el ámbito médico utilizando un LLM basado en LLaMA 3. Simplifica el lenguaje técnico y lo presenta en inglés, español y francés.",
        "proj_2_title": "TrAIner",
        "proj_2_subtitle": "App de Fitness Potenciada por IA",
        "proj_2_desc": "Aplicación móvil para gestionar entrenamientos y nutrición. Incluye TrAInerBot, un asistente virtual basado en IA.",
        "news_title": "Últimas Noticias de IA",
        "contact_title": "Contacto",
        "footer_text": "&copy; 2025 Issam Mezdagat. Construido con Código e IA."
    }
};

document.addEventListener('DOMContentLoaded', () => {
    console.log("DOM fully loaded and parsed");

    // State
    let currentLang = 'es';

    // DOM Elements
    const menuToggle = document.querySelector('.menu-toggle');
    const navLinks = document.querySelector('.nav-links');
    const langToggle = document.getElementById('lang-toggle');
    const newsGrid = document.getElementById('news-grid');

    // Mobile Menu Toggle
    if (menuToggle && navLinks) {
        menuToggle.addEventListener('click', () => {
            navLinks.classList.toggle('active');
            const icon = menuToggle.querySelector('i');
            if (navLinks.classList.contains('active')) {
                icon.classList.remove('fa-bars');
                icon.classList.add('fa-times');
            } else {
                icon.classList.remove('fa-times');
                icon.classList.add('fa-bars');
            }
        });

        // Close menu when clicking a link
        document.querySelectorAll('.nav-links a').forEach(link => {
            link.addEventListener('click', () => {
                navLinks.classList.remove('active');
                const icon = menuToggle.querySelector('i');
                if (icon) {
                    icon.classList.remove('fa-times');
                    icon.classList.add('fa-bars');
                }
            });
        });
    }

    // 3D Tilt Effect for Cards
    const tiltCards = document.querySelectorAll('.tilt-card');
    tiltCards.forEach(card => {
        card.addEventListener('mousemove', (e) => {
            const rect = card.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const centerX = rect.width / 2;
            const centerY = rect.height / 2;

            const rotateX = ((y - centerY) / centerY) * -10; // Max 10deg rotation
            const rotateY = ((x - centerX) / centerX) * 10;

            card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.02)`;
        });

        card.addEventListener('mouseleave', () => {
            card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
        });
    });

    // Scroll Animations
    const observerOptions = {
        threshold: 0.1,
        rootMargin: "0px 0px -50px 0px"
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);

    document.querySelectorAll('.section, .hero-content').forEach(section => {
        section.classList.add('hidden');
        observer.observe(section);
    });

    // Language Switching
    if (langToggle) {
        langToggle.addEventListener('click', () => {
            console.log("Language toggle clicked");
            currentLang = currentLang === 'es' ? 'en' : 'es';
            updateContent();
            langToggle.textContent = currentLang === 'es' ? 'EN' : 'ES';
        });

        // Initialize button text
        langToggle.textContent = 'EN';
    } else {
        console.error("Language toggle button not found");
    }

    function updateContent() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            if (translations[currentLang] && translations[currentLang][key]) {
                element.innerHTML = translations[currentLang][key];
            }
        });

        // Update HTML lang attribute
        document.documentElement.lang = currentLang;

        // Reload news to update "Read More" text if needed
        // But news content is dynamic, so we might need to re-render it or update it in place.
        // For simplicity, we can re-call loadNews() or just update the static parts.
        // The news items themselves (title/desc) are from JSON and might not be translated unless JSON has multiple langs.
        // The "Read More" text IS translated in the template literal in loadNews.
        // So let's re-render news.
        loadNews();
    }

    // Hardcoded News Data (November 2025)
    const newsData = [
        {
            "title": "Google Unveils Gemini 3 Pro",
            "summary": "A major breakthrough with Sparse Mixture-of-Experts Transformer, surpassing GPT-5.1 in reasoning and multimodal capabilities.",
            "source": "Google AI Blog",
            "date": "Nov 20, 2025",
            "image": "https://storage.googleapis.com/gweb-uniblog-publish-prod/images/gemini_1_5_pro_lead.width-1300.jpg",
            "link": "https://blog.google/technology/ai/",
            "tag": "BREAKING"
        },
        {
            "title": "OpenAI Releases GPT-5.1",
            "summary": "New 'Instant' and 'Thinking' versions released, featuring enhanced reasoning and natural conversation flow.",
            "source": "OpenAI",
            "date": "Nov 18, 2025",
            "image": "https://images.openai.com/blob/a2e49de2-ba5b-4869-9c2d-db3b4b5dcc19/gpt-4o-spring-update-wide.jpg?trim=0,0,0,0&width=2000",
            "link": "https://openai.com/blog",
            "tag": "HOT"
        },
        {
            "title": "$100B AI Infrastructure Plan",
            "summary": "Nvidia and OpenAI announce massive investment to build 10 gigawatts of AI data centers to power next-gen models.",
            "source": "TechCrunch",
            "date": "Nov 15, 2025",
            "image": "https://nvidianews.nvidia.com/t/nvidia-news/assets/image/nvidia-hq-exterior?format=jpg&width=1200",
            "link": "https://nvidianews.nvidia.com/",
            "tag": "INDUSTRY"
        },
        {
            "title": "WeatherNext 2 by DeepMind",
            "summary": "Advanced weather forecasting model predicts hundreds of scenarios in under a minute, revolutionizing climate science.",
            "source": "DeepMind",
            "date": "Nov 12, 2025",
            "image": "https://lh3.googleusercontent.com/7f1Yx3y6Xj4x7y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y8y=w1600-h900-rw",
            "link": "https://deepmind.google/discover/blog/",
            "tag": "SCIENCE"
        },
        {
            "title": "Tesla Optimus Gen 4",
            "summary": "Tesla reveals the 4th generation of its humanoid robot, now capable of complex household tasks and full autonomy.",
            "source": "The Verge",
            "date": "Nov 10, 2025",
            "image": "https://digitalassets.tesla.com/tesla-contents/image/upload/f_auto,q_auto/Tesla-Bot-Action-Shot-1.jpg",
            "link": "https://www.tesla.com/AI",
            "tag": "ROBOTICS"
        },
        {
            "title": "Apple Intelligence 2.0",
            "summary": "Apple integrates advanced on-device LLMs into iOS 19, offering privacy-focused AI assistance without cloud processing.",
            "source": "Apple Newsroom",
            "date": "Nov 08, 2025",
            "image": "https://www.apple.com/newsroom/images/2024/06/apple-introduces-apple-intelligence-for-iphone-ipad-and-mac/article/Apple-Intelligence-iPhone-15-Pro-hero_big.jpg.large.jpg",
            "link": "https://www.apple.com/newsroom/",
            "tag": "MOBILE"
        },
        {
            "title": "Quantum AI Breakthrough",
            "summary": "IBM and MIT researchers demonstrate the first practical quantum-enhanced machine learning algorithm.",
            "source": "MIT Technology Review",
            "date": "Nov 05, 2025",
            "image": "https://newsroom.ibm.com/image/IBM_Quantum_System_Two.jpg",
            "link": "https://research.ibm.com/quantum-computing",
            "tag": "QUANTUM"
        },
        {
            "title": "Meta Llama 4 Open Source",
            "summary": "Meta releases Llama 4 with 400B parameters, setting a new standard for open-source AI models.",
            "source": "Meta AI",
            "date": "Nov 02, 2025",
            "image": "https://about.fb.com/wp-content/uploads/2023/07/Llama-2-Header.jpg?w=1920",
            "link": "https://ai.meta.com/",
            "tag": "OPEN SOURCE"
        }
    ];

    // News Loading
    function loadNews() {
        if (!newsGrid) return;

        newsGrid.innerHTML = ''; // Clear loading spinner

        newsData.forEach(item => {
            const newsCard = document.createElement('div');
            newsCard.className = 'news-card glass-card';

            newsCard.innerHTML = `
                <div class="news-tag">${item.tag}</div>
                <div class="news-content">
                    <div class="news-meta">
                        <span class="news-source"><i class="fas fa-bolt"></i> ${item.source}</span>
                        <span class="news-date">${item.date}</span>
                    </div>
                    <h3>${item.title}</h3>
                    <p>${item.summary}</p>
                    <a href="${item.link}" target="_blank" class="read-more">
                        ${currentLang === 'es' ? 'Leer más' : 'Read More'} <i class="fas fa-external-link-alt"></i>
                    </a>
                </div>
            `;

            newsGrid.appendChild(newsCard);
        });
    }

    // Floating Button Logic
    const floatingBtn = document.getElementById('floating-news-btn');
    if (floatingBtn) {
        // Hide button when in news section
        const newsSection = document.getElementById('news');

        window.addEventListener('scroll', () => {
            if (!newsSection) return;

            const rect = newsSection.getBoundingClientRect();
            const isVisible = (rect.top <= window.innerHeight && rect.bottom >= 0);

            if (isVisible) {
                floatingBtn.style.opacity = '0';
                floatingBtn.style.pointerEvents = 'none';
            } else {
                floatingBtn.style.opacity = '1';
                floatingBtn.style.pointerEvents = 'auto';
            }
        });
    }

    loadNews();
});
